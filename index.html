<!DOCTYPE html>
<head>
<title>Test</title>
<meta charset="utf-8">
<script src="d3.min.js" charset="utf-8"></script>
</head>
<body>
<script>
//anfang vorlage
var margin = { top: 20, right: 10, bottom: 20, left: 10 };
var width = window.innerWidth - margin.left - margin.right;
var height = window.innerHeight - margin.top - margin.bottom;

//svg erzeugen
var svg = d3.select("body")
	.append("svg")
	.attr("width", width)
	.attr("height", height)
	.attr("id", "svg")
	.append("g")
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
//ende vorlage

//console zeigen und verwenden
//svg kurz erklären
//step_1();  //alles statisch und hardcoded, erklärung ad koordinationsystem, höhe umdrehen
//step_2();  //positionierung und größe relativ, abstand als variable; veränderung des abstandes in der variablen probieren; höhe als prozentwert verwenden, breite und höhe variieren
//step_3();  //farben; hex und rgb kurz erklären; farben ausprobieren
//step_4();  //array; loop; variable länge verwenden
//step_5();  //sortierung, array of objects
//step_6();  //laden von daten; berechnung der werte, ergänzung weiterer eigenschaften
//step_7();  //mouseover; stroke und ansprache von elementen per id
//step_8();  //einstiegsanimation 1
//step_9();  //einstiegsanimation 2


function step_1()
{
svg.append("rect")
	.attr("x", 0)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 18.94)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", 55)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 35.05)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", 110)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 11.28)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", 165)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 11.12)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", 220)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 2.26)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", 275)
	.attr("y", 0)
	.attr("width", 50)
	.attr("height", 21.34)
	.style("fill", "grey");
	
//umdrehen: gemeinsame grundlinie, zb 100, festlegen, y jeweils auf grundlinie - wert setzen
}

function step_2()
{
var abstand = 5;
var balkenbreite = width / 6 - abstand;
var balkenhoehe = height - margin.top - margin.bottom;

svg.append("rect")
	.attr("x", balkenbreite * 0 + abstand * 0)
	.attr("y", balkenhoehe - balkenhoehe * 18.94 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 18.94 / 100)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", balkenbreite * 1 + abstand * 1)
	.attr("y", balkenhoehe - balkenhoehe * 35.05 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 35.05 / 100)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", balkenbreite * 2 + abstand * 2)
	.attr("y", balkenhoehe - balkenhoehe * 11.28 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 11.28 / 100)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", balkenbreite * 3 + abstand * 3)
	.attr("y", balkenhoehe - balkenhoehe * 11.12 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 11.12 / 100)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", balkenbreite * 4 + abstand * 4)
	.attr("y", balkenhoehe - balkenhoehe * 2.26 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 2.26 / 100)
	.style("fill", "grey");
	
svg.append("rect")
	.attr("x", balkenbreite * 5 + abstand * 5)
	.attr("y", balkenhoehe - balkenhoehe * 21.34 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 21.34 / 100)
	.style("fill", "grey");
}


function step_3()
{
//hex und rgb erklären
//http://www.w3schools.com/colors/colors_picker.asp
//http://tristen.ca/hcl-picker/#/hlc/6/1/15534C/E2E062

var abstand = 5;
var balkenbreite = width / 6 - abstand;
var balkenhoehe = height - margin.top - margin.bottom;

svg.append("rect")
	.attr("x", balkenbreite * 0 + abstand * 0)
	.attr("y", balkenhoehe - balkenhoehe * 18.94 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 18.94 / 100)
	.style("fill", "#8E88A7");
	
svg.append("rect")
	.attr("x", balkenbreite * 1 + abstand * 1)
	.attr("y", balkenhoehe - balkenhoehe * 35.05 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 35.05 / 100)
	.style("fill", "#2657A8");
	
svg.append("rect")
	.attr("x", balkenbreite * 2 + abstand * 2)
	.attr("y", balkenhoehe - balkenhoehe * 11.28 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 11.28 / 100)
	.style("fill", "#C83D44");
	
svg.append("rect")
	.attr("x", balkenbreite * 3 + abstand * 3)
	.attr("y", balkenhoehe - balkenhoehe * 11.12 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 11.12 / 100)
	.style("fill", "#191919");
	
svg.append("rect")
	.attr("x", balkenbreite * 4 + abstand * 4)
	.attr("y", balkenhoehe - balkenhoehe * 2.26 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 2.26 / 100)
	.style("fill", "#E7B500");
	
svg.append("rect")
	.attr("x", balkenbreite * 5 + abstand * 5)
	.attr("y", balkenhoehe - balkenhoehe * 21.34 / 100)
	.attr("width", balkenbreite)
	.attr("height", balkenhoehe * 21.34 / 100)
	.style("fill", "#89A04F");
}


function step_4()
{
var ergebnis = [18.94, 35.05, 11.28, 11.12, 2.26, 21.34];  //array erklären; fängt immer mit 0 an; console zum testen verwenden
var farben = ["#8E88A7", "#2657A8", "#C83D44", "#191919", "#E7B500", "#89A04F"];

var abstand = 5;
var balkenbreite = width / ergebnis.length - abstand;  //.length verwenden
var balkenhoehe = height - margin.top - margin.bottom;

for (var i = 0; i < ergebnis.length; i++)  //zählervariable festlegen
	{
	svg.append("rect")
		.attr("x", balkenbreite * i + abstand * i)
		.attr("y", balkenhoehe - balkenhoehe * ergebnis[i] / 100)
		.attr("width", balkenbreite)
		.attr("height", balkenhoehe * ergebnis[i] / 100)
		.style("fill", farben[i]);
	}

// wie könnte eine beschriftung der balken aussehen?
}


function step_5()
{
var ergebnis = [18.94, 35.05, 11.28, 11.12, 2.26, 21.34];
var farben = ["#8E88A7", "#2657A8", "#C83D44", "#191919", "#E7B500", "#89A04F"];

ergebnis.sort(function(a, b) { return a < b; });  // sortierung erklären; < ist absteigend, > ist aufsteigend; 

//ergebnis passt, farben nicht - lösung ist ein array of objects

var gesamt = [
	{"name":"Griss", "ergebnis":18.94, "farbe":"#8E88A7"},  //achtung auf string und zahl, eigenschaften möglichst mit buchstaben beginnen
	{"name":"Hofer", "ergebnis":35.05, "farbe":"#2657A8"},
	{"name":"Hundstorfer", "ergebnis":11.28, "farbe":"#C83D44"},
	{"name":"Khol", "ergebnis":11.12, "farbe":"#191919"},
	{"name":"Lugner", "ergebnis":2.26, "farbe":"#E7B500"},
	{"name":"Van der Bellen", "ergebnis":21.34, "farbe":"#89A04F"},
	];

//und ein wenig black magic
gesamt.sort(function(a, b) { return d3.descending(a.ergebnis, b.ergebnis); });

var abstand = 5;
var balkenbreite = width / gesamt.length - abstand;  //jetzt gesamt verwenden
var balkenhoehe = height - margin.top - margin.bottom;

for (var i = 0; i < gesamt.length; i++)  //zählervariable festlegen
	{
	svg.append("rect")
		.attr("x", balkenbreite * i + abstand * i)
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100)  //andere bezeichnung
		.attr("width", balkenbreite)
		.attr("height", balkenhoehe * gesamt[i].ergebnis / 100)
		.style("fill", gesamt[i].farbe);
	}
}


function step_6()  //eher weglassen, zu großer schritt?
{
var kandidaten = ["Griss", "Hofer", "Hundstorfer", "Khol", "Lugner", "Van der Bellen"];
var farben = ["#8E88A7", "#2657A8", "#C83D44", "#191919", "#E7B500", "#89A04F"];

d3.csv('ergebnis.csv', function(data)
	{
	//console.log(data);  // vorab einmal in der console anschauen
	
	for (var i = 0; i < data.length; i++)
		{
		for (var x in data[i])
			{
			if (x != "GKZ" && x != "Gebietsname") data[i][x] = +data[i][x];
			}
		}
		
	for (var i = 0; i < kandidaten.length; i++)
		{
		data[0][kandidaten[i]] = data[0][kandidaten[i]] / data[0].gueltig * 100;  // prozentwerte festlegen
		}

	var abstand = 5;
	var balkenbreite = width / kandidaten.length - abstand;  //jetzt kandidaten verwenden
	var balkenhoehe = height - margin.top - margin.bottom;

	for (var i = 0; i < kandidaten.length; i++)  //zählervariable festlegen
		{
		svg.append("rect")
			.attr("x", balkenbreite * i + abstand * i)
			.attr("y", balkenhoehe - balkenhoehe * data[0][kandidaten[i]] / 100)  //andere bezeichnung
			.attr("width", balkenbreite)
			.attr("height", balkenhoehe * data[0][kandidaten[i]] / 100)
			.style("fill", farben[i]);
		}
	});
}


function step_7()
{
var gesamt = [
	{"name":"Griss", "ergebnis":18.94, "farbe":"#8E88A7"},
	{"name":"Hofer", "ergebnis":35.05, "farbe":"#2657A8"},
	{"name":"Hundstorfer", "ergebnis":11.28, "farbe":"#C83D44"},
	{"name":"Khol", "ergebnis":11.12, "farbe":"#191919"},
	{"name":"Lugner", "ergebnis":2.26, "farbe":"#E7B500"},
	{"name":"Van der Bellen", "ergebnis":21.34, "farbe":"#89A04F"},
	];

gesamt.sort(function(a, b) { return d3.descending(a.ergebnis, b.ergebnis); });

var abstand = 5;
var balkenbreite = width / gesamt.length - abstand;
var balkenhoehe = height - margin.top - margin.bottom;

for (var i = 0; i < gesamt.length; i++)
	{
	svg.append("rect")
		.attr("x", balkenbreite * i + abstand * i)
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100)
		.attr("width", balkenbreite)
		.attr("height", balkenhoehe * gesamt[i].ergebnis / 100)
		.attr("id", gesamt[i].name)  //problem "van der bellen" - ev. id in gesamt einfügen
		.style("fill", gesamt[i].farbe)
		.on("mouseover", function() 
			{ 
			d3.select(this).style("stroke", "#15534C").style("stroke-width", "3px");  //zuerst nur stroke als effekt...
			d3.select("#wert_" + this.id).style("display", "block");  //ansprache von id und class
			})
		.on("mouseout", function() 
			{
			d3.select(this).style("stroke", "none"); 
			d3.selectAll("text").style("display", "none");
			})
		
	//...dann ergebnis-anzeige
	svg.append("text")
		.attr("x", balkenbreite * i + abstand * i + balkenbreite / 2)  //positionierung ausprobieren, zentrieren?
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100 - 5)
		.attr("id", "wert_" + gesamt[i].name)
		.style("fill", gesamt[i].farbe)  //andere farbe?  svg-text verwendet fill und stroke, nicht color
		.style("font-size", "24px")  //andere größe?
		.style("text-anchor", "middle")  //zentrieren
		.style("display", "none")
		.text(gesamt[i].ergebnis);
	}
}


function step_8()
{
var gesamt = [
	{"name":"Griss", "ergebnis":18.94, "farbe":"#8E88A7", "id":"griss"},  //id ist neu
	{"name":"Hofer", "ergebnis":35.05, "farbe":"#2657A8", "id":"hofer"},
	{"name":"Hundstorfer", "ergebnis":11.28, "farbe":"#C83D44", "id":"hundstorfer"},
	{"name":"Khol", "ergebnis":11.12, "farbe":"#191919", "id":"khol"},
	{"name":"Lugner", "ergebnis":2.26, "farbe":"#E7B500", "id":"lugner"},
	{"name":"Van der Bellen", "ergebnis":21.34, "farbe":"#89A04F", "id":"vdb"},
	];

gesamt.sort(function(a, b) { return d3.descending(a.ergebnis, b.ergebnis); });

var abstand = 5;
var balkenbreite = width / gesamt.length - abstand;
var balkenhoehe = height - margin.top - margin.bottom;

for (var i = 0; i < gesamt.length; i++)
	{
	svg.append("rect")
		.attr("x", balkenbreite * i + abstand * i)
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100)
		.attr("width", balkenbreite)  
		.attr("height", 0)  //ausgangslage ohne höhe zeichnen
		.attr("id", gesamt[i].id)
		.style("fill", gesamt[i].farbe)
		.on("mouseover", function() 
			{ 
			d3.select(this).style("stroke", "#15534C").style("stroke-width", "3px");
			d3.select("#wert_" + this.id).style("display", "block");
			})
		.on("mouseout", function() 
			{
			d3.select(this).style("stroke", "none"); 
			d3.selectAll("text").style("display", "none");
			})

	svg.append("text")
		.attr("x", balkenbreite * i + abstand * i + balkenbreite / 2)
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100 - 5)
		.attr("id", "wert_" + gesamt[i].id)
		.style("fill", gesamt[i].farbe)
		.style("font-size", "24px")
		.style("text-anchor", "middle")
		.style("display", "none")
		.text(gesamt[i].ergebnis);
	}

for (var i = 0; i < gesamt.length; i++)
	{
	svg.select("#" + gesamt[i].id)
		.transition()
		.duration(1000)		
		.attr("height", balkenhoehe * gesamt[i].ergebnis / 100); 
	}
	
//korrektur der animation: y = gesamthöhe setzen, dann y verschieben und höhe anpassen
}


function step_9()
{
var gesamt = [
	{"name":"Griss", "ergebnis":18.94, "farbe":"#8E88A7", "id":"griss"},  //id ist neu
	{"name":"Hofer", "ergebnis":35.05, "farbe":"#2657A8", "id":"hofer"},
	{"name":"Hundstorfer", "ergebnis":11.28, "farbe":"#C83D44", "id":"hundstorfer"},
	{"name":"Khol", "ergebnis":11.12, "farbe":"#191919", "id":"khol"},
	{"name":"Lugner", "ergebnis":2.26, "farbe":"#E7B500", "id":"lugner"},
	{"name":"Van der Bellen", "ergebnis":21.34, "farbe":"#89A04F", "id":"vdb"},
	];

gesamt.sort(function(a, b) { return d3.descending(a.ergebnis, b.ergebnis); });

var abstand = 5;
var balkenbreite = width / gesamt.length - abstand;
var balkenhoehe = height - margin.top - margin.bottom;

for (var i = 0; i < gesamt.length; i++)
	{
	svg.append("rect")
		.attr("x", balkenbreite * i + abstand * i)
		.attr("y", balkenhoehe)
		.attr("width", balkenbreite)  
		.attr("height", 0)
		.attr("id", gesamt[i].id)
		.style("fill", gesamt[i].farbe)
		.on("mouseover", function() 
			{ 
			d3.select(this).style("stroke", "#15534C").style("stroke-width", "3px");
			d3.select("#wert_" + this.id).style("display", "block");
			})
		.on("mouseout", function() 
			{
			d3.select(this).style("stroke", "none"); 
			d3.selectAll("text").style("display", "none");
			})

	svg.append("text")
		.attr("x", balkenbreite * i + abstand * i + balkenbreite / 2)
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100 - 5)
		.attr("id", "wert_" + gesamt[i].id)
		.style("fill", gesamt[i].farbe)
		.style("font-size", "24px")
		.style("text-anchor", "middle")
		.style("display", "none")
		.text(gesamt[i].ergebnis);
	}

for (var i = 0; i < gesamt.length; i++)
	{
	svg.select("#" + gesamt[i].id)
		.transition()
		.duration(1000)
		.delay(500 * i)  //gestaffelt
		.attr("y", balkenhoehe - balkenhoehe * gesamt[i].ergebnis / 100)
		.attr("height", balkenhoehe * gesamt[i].ergebnis / 100);
		
	//ev. auch werte mit verzögerung anzeigen?
	}
}

</script>
</body>
</html>